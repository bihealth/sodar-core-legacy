<!DOCTYPE html>
{% load static %}
{% load projectroles_tags %}
{% load projectroles_common_tags %}
{% load rules %}

{# Local variables #}
{% get_setting 'SITE_SUBTITLE' as site_subtitle %}

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Projectroles Example{% if site_subtitle %} {{ site_subtitle }}{% endif %}: {% block title %}Page Title{% endblock title %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Javascript includes -->

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Required by Bootstrap v4 -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>

    <!-- Shepherd -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.4/js/tether.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/shepherd/1.8.1/js/shepherd.min.js"></script>

    <!-- Clipboard helper -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>

    {% block css %}

      <!-- CSS includes -->

      <!-- Fix for pull-right/pull-left bug when including improts -->
      <style type="text/css">
        .pull-right {
          float: right;
        }

        .pull-left {
          float: left;
        }
      </style>

      <!-- Local Font Awesome Icons -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

      <!-- Bootstrap 4 CSS -->
      <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">

      <!-- Shepherd theme -->
      <link rel="stylesheet" href="{% static 'css/shepherd-theme-omics.css' %}" />

      <!-- Project-specific CSS -->
      <link href="{% static 'css/project.css' %}" rel="stylesheet">

    {% endblock css %}

    {% block head_extend %}
      {# Extended head stuff from apps goes here #}
    {% endblock head_extend %}
  </head>

  <body>
    <div class="omics-base-container">
      <div class="omics-top-container">
        <div class="m-b-1 omics-titlebar-container">
          <nav class="navbar navbar-expand-lg navbar-dark bg-dark omics-base-navbar" id="omics-base-navbar">
            <a class="navbar-brand" id="omics-base-navbar-brand" href="/">
              SODAR Projectroles Example Site
              {% comment TODO %}
                <img class="omics-navbar-logo" src="{% static 'images/logo_navbar.png' %}" />SODAR
                {% if site_subtitle %}{{ site_subtitle }}{% endif %}
              {% endcomment %}
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav ml-auto" id="omics-base-navbar-nav">

                {# Search #}
                {% if request.user.is_authenticated %}
                  <li class="nav-item omics-navbar-search">
                    <form class="form-inline" method="get" action="{% url 'projectroles:search' %}">
                      <div class="input-group omics-input-group">
                        <input class="form-control" type="text"
                               placeholder="Search term" name="s" aria-label="Search term"
                               id="omics-nav-search-input" value="{{ search_input }}">
                         <div class="input-group-append">
                           <button class="btn btn-success" type="submit" id="omics-nav-search-submit" disabled>Search</button>
                         </div>
                      </div>
                    </form>
                  </li>
                {% endif %}

                {# Admin link #}
                {% if request.user.is_superuser %}
                    <li class="nav-item">
                      <a class="nav-link"
                         href="{% url 'admin:index' %}" target="_blank"
                         id="omics-navbar-admin-link">
                        <i class="fa fa-fw fa-gears"></i> Admin</a>
                    </li>
                {% endif %}

                {# Site-wide apps #}
                {% get_site_apps as site_apps %}
                {% for plugin in site_apps %}
                  {% has_perm plugin.app_permission request.user as can_view_app %}
                  {% if not plugin.app_permission or can_view_app %}
                    <li class="nav-item omics-navbar-siteapp-item {% get_app_link_state plugin request.resolver_match.app_name request.resolver_match.url_name %}">
                      <a class="nav-link"
                         href="{% url plugin.entry_point_url_id %}"
                         id="omics-navbar-siteapp-link-{{ plugin.name }}">
                        <i class="fa fa-fw fa-{{ plugin.icon }}"></i> {{ plugin.title }}</a>
                    </li>
                  {% endif %}
                {% endfor %}

                {% comment TODO %}
                  {# Manual link #}
                  <li class="nav-item">
                    <a href="/manual/" class="nav-link" id="site-manual-link" target="_blank"><i class="fa fa-fw fa-map-o"></i> Manual</a>
                  </li>
                {% endcomment %}

                {# Help link #}
                <li class="nav-item">
                  <a class="nav-link {% get_help_highlight request.user %}"
                     id="site-help-link"><i class="fa fa-fw fa-info-circle"></i> Help</a>
                </li>

                {# Hidden user menu options for responsive menu #}
                {% if request.user.is_authenticated %}
                  <li class="nav-item omics-navbar-alt-item">
                    <a class="nav-link"
                       href="{{ request.user.get_absolute_url }}"
                       id="omics-alt-navbar-link-user-details"><i class="fa fa-fw fa-user-circle-o"></i> User Profile</a>
                  </li>

                  <li class="nav-item omics-navbar-alt-item">
                    <a class="nav-link text-danger"
                       href="{% url 'account_logout' %}"
                       id="omics-alt-nav-link-sign-out"><i class="fa fa-fw fa-sign-out"></i> Sign Out</a>
                  </li>
                {% endif %}

                {# Normal user menu #}
                <li class="nav-item omics-navbar-user-dropdown">
                  <a class="nav-link omics-nav-link-last dropdown-toggle {% if not request.user.is_authenticated %}disabled{% endif %}"
                     id="omics-navbar-user-dropdown{% if not request.user.is_authenticated%}-disabled{% endif %}"
                     data-toggle="dropdown">
                    <i class="fa fa-fw fa-user"></i>
                  </a>
                  <div class="dropdown-menu dropdown-menu-right omics-navbar-user-dropdown">
                    <div class="dropdown-header">{{ request.user.name }}<br />{{ request.user.username }}</div>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="{{ request.user.get_absolute_url }}" id="omics-navbar-link-user-details">
                      <i class="fa fa-fw fa-user-circle-o"></i> User Profile
                    </a>
                    <a class="dropdown-item text-danger" href="{% url 'account_logout' %}" id="omics-navbar-link-logout">
                      <i class="fa fa-fw fa-sign-out"></i> Sign Out
                    </a>
                  </div>
                </li>
              </ul>
            </div>

          </nav>
        </div>

      </div> <!-- /omics-top-container -->

      <div class="omics-content-container">

        {# Sidebar #}
        <div class="omics-content-left">
          <div class="col h-100 bg-dark text-center omics-pr-sidebar" id="omics-pr-sidebar">
            <nav class="nav navbar-expand-lg navbar-dark bg-dark omics-pr-sidebar-nav">
              <div class="collapse navbar-collapse" id="omics-pr-sidebar-navbar">
                <ul class="navbar-nav flex-column omics-pr-sidebar-nav-ul">
                  <li id="omics-pr-nav-home" class="nav-item {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                    <a class="nav-link"
                       href="{% url 'home' %}"
                       id="omics-pr-nav-home-link">
                      <i class="fa fa-home"></i><br />Home
                    </a>
                  </li>
                  {% block sidebar %}
                  {% endblock sidebar %}
                </ul>
              </div>
            </nav>
          </div>
        </div>

        {# Content #}
        <div class="omics-content-right">
          {% block content %}
            <p>Use this document as a way to quick start any new project.</p>
          {% endblock content %}
        </div>

      </div> <!-- /omics-content-container -->

    {# Custom template for Bootstrap4 modal #}
    {% block modal %}
      {% include 'projectroles/_modal.html' %}
    {% endblock modal %}

    <!-- Project specific Javascript -->
    {% block javascript %}
      <script src="{% static 'js/project.js' %}"></script>

      <script type="text/javascript">
        tour.addStep('tour_intro', {
            title: 'Welcome to the Tour Help!',
            text: 'The tour help describes key elements on the currently opened ' +
                  'page and aids you in using available features. Advance on ' +
                  'the tour by clicking "Next".',
            advanceOn: '.docs-link click',
            showCancelLink: true
        });
      </script>
    {% endblock javascript %}

    {# Set up Tour link #}

    <script type="text/javascript">
        if (tourEnabled == false) {
            $('#site-help-link').addClass(
                'disabled').removeClass('text-warning');
        }

        $('#site-help-link').click(function() {
            tour.start();
        });
    </script>

    </div> <!-- /omics-base-container -->

  </body>
</html>
